<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>model_selection_diagnostics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="model_selection_diagnostics_files/libs/clipboard/clipboard.min.js"></script>
<script src="model_selection_diagnostics_files/libs/quarto-html/quarto.js"></script>
<script src="model_selection_diagnostics_files/libs/quarto-html/popper.min.js"></script>
<script src="model_selection_diagnostics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="model_selection_diagnostics_files/libs/quarto-html/anchor.min.js"></script>
<link href="model_selection_diagnostics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="model_selection_diagnostics_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="model_selection_diagnostics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="model_selection_diagnostics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="model_selection_diagnostics_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="model_selection_diagnostics_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="model_selection_diagnostics_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries">Libraries</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#data-characteristics" id="toc-data-characteristics" class="nav-link" data-scroll-target="#data-characteristics">Data characteristics</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#data-quality-checks" id="toc-data-quality-checks" class="nav-link" data-scroll-target="#data-quality-checks">Data quality checks</a></li>
  <li><a href="#ratio-of-variance-to-mean-of-cases-by-race-sex-and-year" id="toc-ratio-of-variance-to-mean-of-cases-by-race-sex-and-year" class="nav-link" data-scroll-target="#ratio-of-variance-to-mean-of-cases-by-race-sex-and-year">Ratio of variance to mean of cases by race, sex, and year</a></li>
  <li><a href="#visualize-distribution-of-number-of-cases-for-census-tract-for-all-race-groups" id="toc-visualize-distribution-of-number-of-cases-for-census-tract-for-all-race-groups" class="nav-link" data-scroll-target="#visualize-distribution-of-number-of-cases-for-census-tract-for-all-race-groups">Visualize distribution of number of cases for census tract for all race groups</a></li>
  </ul></li>
  <li><a href="#analysis-part-1" id="toc-analysis-part-1" class="nav-link" data-scroll-target="#analysis-part-1">Analysis Part 1</a>
  <ul class="collapse">
  <li><a href="#visualize-bivariate-associations" id="toc-visualize-bivariate-associations" class="nav-link" data-scroll-target="#visualize-bivariate-associations">Visualize bivariate associations</a></li>
  <li><a href="#hurdle-model-comparison" id="toc-hurdle-model-comparison" class="nav-link" data-scroll-target="#hurdle-model-comparison">Hurdle Model Comparison</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">model_selection_diagnostics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="libraries" class="level2">
<h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'glmmTMB'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'MASS'</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'bbmle'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'ggplot2'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'ggthemes'</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'data.table'</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'DHARMa'</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'tidyverse'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'kableExtra'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level1">
<h1>Import data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"//cdc.gov/project/ATS_GIS_Store4/Projects/prj06135_Shigella_SVI/Data/Final Datasets/"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>race<span class="ot">&lt;-</span><span class="fu">setDT</span>(<span class="fu">read.csv</span>(<span class="st">"Final_Aggregate_ByRace_2022-12-28.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-characteristics" class="level1">
<h1>Data characteristics</h1>
<p>The final dataset includes a row for each unique combination of census tract, time period, age group, sex, and race. The outcome variable, <strong>Cases</strong>, is the aggregate number of cases for that combination. The <strong>Pop</strong> variable corresponds to the underlying population total in that category. Because population data was not available for cross-tabluations of race and ethnicity, race and ethnicity case and population totals have been calculated separately (each race category includes both Hispanic and non-Hispanic categories. Records have been merged with the SVI data that most closely corresponds to the year of diagnosis and with the NCHS urban-rural classification codes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(race)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         GEOID sviyear AgeGroup Sex Race Pop moe Cases State RPL_THEMES
1: 2.00006e+14    2000      0-4   F    A  26  NA     0    CA      0.029
2: 2.00006e+14    2000      0-4   F    B   4  NA     0    CA      0.029
3: 2.00006e+14    2000      0-4   F    I   0  NA     0    CA      0.029
4: 2.00006e+14    2000      0-4   F    M   8  NA     0    CA      0.029
5: 2.00006e+14    2000      0-4   F    O   0  NA     0    CA      0.029
6: 2.00006e+14    2000      0-4   F    P   0  NA     0    CA      0.029
   quartile            UrCode
1:        1 lrg central metro
2:        1 lrg central metro
3:        1 lrg central metro
4:        1 lrg central metro
5:        1 lrg central metro
6:        1 lrg central metro</code></pre>
</div>
</div>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>Because census tract ID’s are reused between versions, we need to qualify the census tract id number by census tract version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>race[,GEOID <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(sviyear<span class="sc">==</span><span class="dv">2000</span>, <span class="fu">paste0</span>(<span class="st">'2000'</span>, GEOID), <span class="fu">paste0</span>(<span class="st">'2010'</span>, GEOID))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Factor covariates and set desired reference category.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>race[, <span class="fu">c</span>(<span class="st">'Race'</span>, <span class="st">'UrCode'</span>, <span class="st">'quartile'</span>) <span class="sc">:</span><span class="er">=</span> <span class="fu">list</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">factor</span>(Race, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">'W'</span>, <span class="st">'B'</span>, <span class="st">'A'</span>, <span class="st">'I'</span>, <span class="st">'P'</span>, <span class="st">'M'</span>, <span class="st">'O'</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">labels=</span><span class="fu">c</span>(<span class="st">'White'</span>, <span class="st">'Black'</span>, <span class="st">'Asian'</span>, <span class="st">'Native American'</span>, </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'Pacific Islander'</span>, <span class="st">'Multiracial'</span>, <span class="st">'Other'</span>)),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">factor</span>(UrCode, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">'lrg central metro'</span>, <span class="st">'lrg fringe metro'</span>, <span class="st">'med metor'</span>,                                     <span class="st">'sml metro'</span>, <span class="st">'micropolitan'</span>, <span class="st">'non-core'</span>)),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">factor</span>(quartile, <span class="at">levels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-quality-checks" class="level2">
<h2 class="anchored" data-anchor-id="data-quality-checks">Data quality checks</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(race[Cases<span class="sc">&gt;</span>Pop, .N, <span class="at">by=</span><span class="fu">c</span>(<span class="st">'Race'</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Race </th>
   <th style="text-align:right;"> N </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 361 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> White </td>
   <td style="text-align:right;"> 85 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Black </td>
   <td style="text-align:right;"> 310 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Native American </td>
   <td style="text-align:right;"> 83 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pacific Islander </td>
   <td style="text-align:right;"> 60 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Asian </td>
   <td style="text-align:right;"> 118 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Multiracial </td>
   <td style="text-align:right;"> 94 </td>
  </tr>
</tbody>
</table>

</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>temp<span class="ot">&lt;-</span>race[, <span class="fu">list</span>(<span class="at">Percent_with_no_cases =</span> <span class="fu">sum</span>(Cases<span class="sc">==</span><span class="dv">0</span>)<span class="sc">/</span>.N), </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                 by<span class="ot">=</span><span class="fu">list</span>(AgeGroup, Sex, sviyear, Race)]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(temp<span class="sc">$</span>Percent_with_no_cases)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9259  0.9921  0.9984  0.9918  0.9995  1.0000 </code></pre>
</div>
</div>
<p>There are <strong>1111</strong> records with more cases than population. This may be due to sampling error in the population data, which is sourced from the ACS for sviyears after 2005. Additionally, the average number of tracts without any cases for a specific category combination is <strong>0.9918296</strong>.</p>
</section>
<section id="ratio-of-variance-to-mean-of-cases-by-race-sex-and-year" class="level2">
<h2 class="anchored" data-anchor-id="ratio-of-variance-to-mean-of-cases-by-race-sex-and-year">Ratio of variance to mean of cases by race, sex, and year</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(<span class="fu">dcast</span>(Race <span class="sc">+</span> Sex <span class="sc">~</span> sviyear, <span class="at">value.var =</span> <span class="st">'Ratio'</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data=</span>race[,  <span class="fu">list</span>(<span class="at">Ratio=</span><span class="fu">round</span>(<span class="fu">var</span>(Cases)<span class="sc">/</span><span class="fu">mean</span>(Cases), <span class="dv">3</span>)), </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'Race'</span>, <span class="st">'Sex'</span>, <span class="st">'sviyear'</span>)]))  <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Race </th>
   <th style="text-align:left;"> Sex </th>
   <th style="text-align:right;"> 2000 </th>
   <th style="text-align:right;"> 2010 </th>
   <th style="text-align:right;"> 2014 </th>
   <th style="text-align:right;"> 2016 </th>
   <th style="text-align:right;"> 2018 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> White </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.231 </td>
   <td style="text-align:right;"> 1.533 </td>
   <td style="text-align:right;"> 1.299 </td>
   <td style="text-align:right;"> 1.252 </td>
   <td style="text-align:right;"> 1.099 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> White </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 1.505 </td>
   <td style="text-align:right;"> 1.782 </td>
   <td style="text-align:right;"> 1.745 </td>
   <td style="text-align:right;"> 1.340 </td>
   <td style="text-align:right;"> 1.531 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Black </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.161 </td>
   <td style="text-align:right;"> 1.430 </td>
   <td style="text-align:right;"> 1.339 </td>
   <td style="text-align:right;"> 1.187 </td>
   <td style="text-align:right;"> 1.075 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Black </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 1.193 </td>
   <td style="text-align:right;"> 1.417 </td>
   <td style="text-align:right;"> 1.406 </td>
   <td style="text-align:right;"> 1.260 </td>
   <td style="text-align:right;"> 1.455 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Asian </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.082 </td>
   <td style="text-align:right;"> 0.998 </td>
   <td style="text-align:right;"> 1.096 </td>
   <td style="text-align:right;"> 0.999 </td>
   <td style="text-align:right;"> 1.068 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Asian </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 0.999 </td>
   <td style="text-align:right;"> 1.050 </td>
   <td style="text-align:right;"> 1.044 </td>
   <td style="text-align:right;"> 1.025 </td>
   <td style="text-align:right;"> 1.050 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Native American </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.374 </td>
   <td style="text-align:right;"> 2.471 </td>
   <td style="text-align:right;"> 1.538 </td>
   <td style="text-align:right;"> 1.421 </td>
   <td style="text-align:right;"> 1.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Native American </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 1.482 </td>
   <td style="text-align:right;"> 2.070 </td>
   <td style="text-align:right;"> 1.363 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pacific Islander </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Pacific Islander </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.000 </td>
   <td style="text-align:right;"> 1.111 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Multiracial </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.285 </td>
   <td style="text-align:right;"> 0.999 </td>
   <td style="text-align:right;"> 1.048 </td>
   <td style="text-align:right;"> 1.044 </td>
   <td style="text-align:right;"> 0.999 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Multiracial </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 0.999 </td>
   <td style="text-align:right;"> 1.110 </td>
   <td style="text-align:right;"> 1.145 </td>
   <td style="text-align:right;"> 1.070 </td>
   <td style="text-align:right;"> 1.062 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Other </td>
   <td style="text-align:left;"> F </td>
   <td style="text-align:right;"> 1.204 </td>
   <td style="text-align:right;"> 1.195 </td>
   <td style="text-align:right;"> 1.193 </td>
   <td style="text-align:right;"> 1.081 </td>
   <td style="text-align:right;"> 1.071 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Other </td>
   <td style="text-align:left;"> M </td>
   <td style="text-align:right;"> 0.999 </td>
   <td style="text-align:right;"> 1.099 </td>
   <td style="text-align:right;"> 1.086 </td>
   <td style="text-align:right;"> 1.088 </td>
   <td style="text-align:right;"> 1.159 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="visualize-distribution-of-number-of-cases-for-census-tract-for-all-race-groups" class="level2">
<h2 class="anchored" data-anchor-id="visualize-distribution-of-number-of-cases-for-census-tract-for-all-race-groups">Visualize distribution of number of cases for census tract for all race groups</h2>
<p>These plots shows distribution of tracts by number of cases for each race and ethnicity category for all years, age groups and sex combined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(race[, <span class="fu">list</span>(<span class="at">Cases=</span><span class="fu">sum</span>(Cases)), <span class="at">by=</span><span class="fu">list</span>(GEOID, Race)], </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>Cases)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>Race)<span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position=</span><span class="st">"identity"</span>, <span class="at">bins=</span><span class="dv">10</span>, <span class="at">fill=</span><span class="st">'#D23E43'</span>, <span class="at">color=</span><span class="st">'black'</span>)<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
</section>
</section>
<section id="analysis-part-1" class="level1">
<h1>Analysis Part 1</h1>
<p><strong>Original Research Objective:</strong> Are there residual effects of race on the incidence of Shigella after controlling for SVI?</p>
<p><strong>Alternate Research Objective:</strong> Does the impact of SVI on Shigella incidence vary by race?</p>
<p><strong>Primary outcome:</strong> New cases of Shigella, offset by population</p>
<p><strong>Primary predictor:</strong> SVI quartile</p>
<p><strong>Additional covariates:</strong> Sex, age group, year (grouped by svi version)</p>
<hr>
<p>I have records with zero population so including population counts as an offset (i.e., log(0)=-inf error). Therefore, I’m dropping zero population counts and including the log of pop as an offset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>race<span class="ot">&lt;-</span>race[Pop<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> Cases <span class="sc">&lt;=</span> Pop <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Race), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="visualize-bivariate-associations" class="level2">
<h2 class="anchored" data-anchor-id="visualize-bivariate-associations">Visualize bivariate associations</h2>
<p><strong>Shigella Rate per 100K by SVI Quartile and Race among Tracts One or More Cases</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(race[Cases<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;!</span><span class="fu">is.na</span>(quartile),],<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(quartile),<span class="at">y=</span>Cases<span class="sc">/</span>Pop<span class="sc">*</span><span class="dv">100000</span>, <span class="at">color=</span>Race))<span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Race, <span class="at">scales=</span><span class="st">'free'</span>)<span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data=</span>mean_cl_boot,<span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_calc</span>()<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Log(Shigella Rate per 100K) by SVI Score among Tracts One or More Cases by Age and Sex for Each Race Category</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">&lt;-</span> race <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Cases<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(.<span class="sc">$</span>Race) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">ggplot</span>(.x, <span class="fu">aes</span>(RPL_THEMES, <span class="fu">log</span>(Cases<span class="sc">/</span>Pop<span class="sc">*</span><span class="dv">100000</span>))) <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="at">cols=</span><span class="fu">vars</span>(AgeGroup), <span class="at">rows=</span><span class="fu">vars</span>(Sex), <span class="at">scales=</span><span class="st">'free'</span>)<span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_sum</span>(<span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span> <span class="do">## show overlapping/replicated points as circles (semi-transparent)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_size</span>(<span class="at">range=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">8</span>)) <span class="sc">+</span> <span class="do">## cosmetic: make minimum size (non-replicated) points larger  </span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="do">## fit and display a flexible smooth curve for point data</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"gam"</span>,<span class="at">method.args=</span><span class="fu">list</span>(<span class="at">family=</span><span class="st">"quasipoisson"</span>))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">White</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Black</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Asian</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Native American</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Pacific Islander</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">Multiracial</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Other</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-5.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-6.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-12-7.png" class="img-fluid" width="1152"></p>
</div>
</div>
</div>
</div>
</section>
<section id="hurdle-model-comparison" class="level2">
<h2 class="anchored" data-anchor-id="hurdle-model-comparison">Hurdle Model Comparison</h2>
<p>The original analysis plan calls for models stratified by race. For brevity, I am testing models on the reference race category (White). These models and the simulated residuals take a long time to run, so I’ll only run the final model on all race categories.</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>datlist<span class="ot">&lt;-</span>race <span class="sc">%&gt;%</span> <span class="fu">split</span>(.<span class="sc">$</span>Race)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create list of hurdle poisson and hurdle negative binomial models to compare fit. Each model includes the log of population as an offset term and a random intercept for the unique tract in the conditional portion of the model. Different covariates are evaluated in both the conditional and the zero-inflation (binomial) portion of the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Truncated Poisson Distribution </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Null model</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">&lt;-</span><span class="fu">glmmTMB</span>(Cases <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(Pop)) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>GEOID), <span class="at">zi=</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">family=</span>truncated_poisson, <span class="at">data=</span>datlist<span class="sc">$</span>White)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">update</span>(m0, Cases <span class="sc">~</span> quartile <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(Pop)) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>GEOID))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span><span class="fu">update</span>(m1, Cases <span class="sc">~</span> quartile <span class="sc">+</span> sviyear <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(Pop)) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>GEOID))</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">&lt;-</span><span class="fu">update</span>(m2, Cases <span class="sc">~</span> quartile <span class="sc">+</span> sviyear <span class="sc">+</span> Sex <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(Pop)) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>GEOID))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">update</span>(m3, Cases <span class="sc">~</span> quartile <span class="sc">+</span> sviyear <span class="sc">+</span> Sex <span class="sc">+</span> AgeGroup <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(Pop)) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>GEOID))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>m5<span class="ot">&lt;-</span><span class="fu">update</span>(m4, <span class="at">ziformula=</span><span class="sc">~</span>quartile <span class="sc">+</span> sviyear <span class="sc">+</span> Sex <span class="sc">+</span> AgeGroup)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>m6<span class="ot">&lt;-</span><span class="fu">update</span>(m5, <span class="at">ziformula=</span><span class="sc">~</span>.)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Truncated negative binomial distribution</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>m7<span class="ot">&lt;-</span><span class="fu">update</span>(m0, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>m8<span class="ot">&lt;-</span><span class="fu">update</span>(m1, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>m9<span class="ot">&lt;-</span><span class="fu">update</span>(m2, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>m10<span class="ot">&lt;-</span><span class="fu">update</span>(m3, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>m11<span class="ot">&lt;-</span><span class="fu">update</span>(m4, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>m12<span class="ot">&lt;-</span><span class="fu">update</span>(m5, <span class="at">family=</span>truncated_nbinom2)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>m13<span class="ot">&lt;-</span><span class="fu">update</span>(m6, <span class="at">family=</span>truncated_nbinom2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Compare model information</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>models<span class="ot">&lt;-</span><span class="fu">list</span>(m0, m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12, m13)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>model_specs<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(models)){</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">1</span>]<span class="ot">&lt;-</span><span class="fu">as.character</span>(models[[i]]<span class="sc">$</span>call)[<span class="dv">2</span>]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">2</span>]<span class="ot">&lt;-</span> <span class="fu">as.character</span>(models[[i]]<span class="sc">$</span>modelInfo<span class="sc">$</span>allForm<span class="sc">$</span>ziformula)[[<span class="dv">2</span>]]</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">3</span>]<span class="ot">&lt;-</span><span class="fu">as.character</span>(models[[i]]<span class="sc">$</span>call)[<span class="dv">4</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">4</span>]<span class="ot">&lt;-</span><span class="fu">AIC</span>(models[[i]])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">5</span>]<span class="ot">&lt;-</span><span class="fu">ifelse</span>(models[[i]]<span class="sc">$</span>fit<span class="sc">$</span>convergence<span class="sc">==</span><span class="dv">0</span>, <span class="st">'Yes'</span>, <span class="st">'No'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">6</span>]<span class="ot">&lt;-</span><span class="fu">length</span>(models[[i]]<span class="sc">$</span>fit<span class="sc">$</span>par)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  model_specs[i, <span class="dv">7</span>]<span class="ot">&lt;-</span><span class="fu">sigma</span>(models[[i]])</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(model_specs)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">'Conditional Formula'</span>, <span class="st">'ZI Formula'</span>, <span class="st">'Distribution'</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'AIC'</span>, <span class="st">'Covergence'</span>, <span class="st">'DF'</span>, <span class="st">'Dispersion Parameter'</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>model_specs <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">"striped"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class=" lightable-material lightable-striped" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> Conditional Formula </th>
   <th style="text-align:left;"> ZI Formula </th>
   <th style="text-align:left;"> Distribution </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:left;"> Covergence </th>
   <th style="text-align:right;"> DF </th>
   <th style="text-align:right;"> Dispersion Parameter </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Cases ~ offset(log(Pop)) + (1 | GEOID) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 139669.9 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 139576.7 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 139577.2 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 139514.1 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 138220.1 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> quartile + sviyear + Sex + AgeGroup </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 137467.2 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> quartile + sviyear + Sex + AgeGroup + (1 | GEOID) </td>
   <td style="text-align:left;"> truncated_poisson </td>
   <td style="text-align:right;"> 132253.5 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 1.000000e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ offset(log(Pop)) + (1 | GEOID) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 139194.6 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 2.121508e-01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 139088.0 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 1.510907e-01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 139083.3 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 1.425852e-01 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:left;"> No </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 1.117559e+10 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> 1 </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 139290.4 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 3.300000e-06 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> quartile + sviyear + Sex + AgeGroup </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 137438.3 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 20 </td>
   <td style="text-align:right;"> 4.728360e+00 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Cases ~ quartile + sviyear + Sex + AgeGroup + (1 | GEOID) + offset(log(Pop)) </td>
   <td style="text-align:left;"> quartile + sviyear + Sex + AgeGroup + (1 | GEOID) </td>
   <td style="text-align:left;"> truncated_nbinom2 </td>
   <td style="text-align:right;"> 132224.5 </td>
   <td style="text-align:left;"> Yes </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;"> 4.728549e+00 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Extract model with best overall fit</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>final_mod<span class="ot">&lt;-</span>models[[<span class="fu">which.min</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(models),<span class="cf">function</span>(x)<span class="fu">AIC</span>(models[[x]])))]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Visualize simulated residuals from best fit model.</strong> This takes &gt; 15 min</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>simulationOutput <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> final_mod, <span class="at">n =</span> <span class="dv">1000</span>) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulationOutput)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = 'bootstrap'. See ?testOutliers for details</code></pre>
</div>
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testDispersion</span>(<span class="at">simulationOutput =</span> simulationOutput, <span class="at">alternative =</span><span class="st">"less"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa nonparametric dispersion test via sd of residuals fitted vs.
    simulated

data:  simulationOutput
dispersion = 0.94932, p-value = 0.513
alternative hypothesis: less</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">testUniformity</span>(<span class="at">simulationOutput =</span> simulationOutput, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>DHARMa:testOutliers with type = binomial may have inflated Type I error rates for integer-valued distributions. To get a more exact result, it is recommended to re-run testOutliers with type = 'bootstrap'. See ?testOutliers for details</code></pre>
</div>
<div class="cell-output-display">
<p><img src="model_selection_diagnostics_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  simulationOutput$scaledResiduals
D = 0.0014965, p-value = 0.315
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predicted probabilities (p=p.1*(1-p.2))</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#--------------------------------------------------------------------</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>p<span class="ot">&lt;-</span><span class="fu">predict</span>(m9, <span class="at">type=</span><span class="st">'response'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>p<span class="fl">.1</span><span class="ot">&lt;-</span><span class="fu">predict</span>(m9, <span class="at">type=</span><span class="st">'conditional'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>p<span class="fl">.2</span><span class="ot">&lt;-</span><span class="fu">predict</span>(m9, <span class="at">type=</span><span class="st">'zprob'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>